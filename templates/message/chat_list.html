{% extends 'core/base.html' %}
{% load static %}

{% block title %}Chat List{% endblock %}

{% block content %}
<style>
    .chat-list-container {
        max-width: 800px;
        margin: 0 auto;
    }
    .chat-list-header {
        background: linear-gradient(to right, #4a90e2, #357abd);
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        color: white;
    }
    .chat-list-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        border-radius: 12px;
        border: none;
        margin-bottom: 1rem;
    }
    .chat-list-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .chat-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        overflow: hidden;
    }
    .chat-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .unread-badge {
        background: linear-gradient(to right, #ff6b6b, #ee5253);
        border: 2px solid white;
        padding: 0.25rem 0.75rem;
    }
    .empty-state {
        text-align: center;
        padding: 3rem;
        background: white;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
</style>

<div class="chat-list-container">
    <div class="chat-list-header">
        <h2 class="mb-0"><i class="bi bi-chat-dots me-2"></i>Your Conversations</h2>
    </div>
    
    {% if friends %}
        <div class="chat-list">
            {% for friend in friends %}
                <a href="{% url 'message_chat:chat_detail' friend.username %}" class="card chat-list-card text-decoration-none">
                    <div class="card-body d-flex align-items-center justify-content-between p-3">
                        <div class="d-flex align-items-center">
                            <div class="chat-avatar">
                                {% if friend.userprofile.profile_picture %}
                                    <img src="{{ friend.userprofile.profile_picture.url }}" alt="{{ friend.username }}">
                                {% else %}
                                    <img src="{% static 'core/images/default-profile.png' %}" alt="Default Profile">
                                {% endif %}
                            </div>
                            <div class="ms-3">
                                <h5 class="mb-1 text-dark">{{ friend.username }}</h5>
                                <small class="text-muted d-flex align-items-center">
                                    <i class="bi bi-circle-fill me-1 fs-6"></i>
                                    Online
                                </small>
                            </div>
                        </div>
                        {% if friend.received_messages.filter|dictsort:"is_read=False, receiver=request.user"|length > 0 %}
                            <span class="badge unread-badge">New Messages</span>
                        {% endif %}
                    </div>
                </a>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <i class="bi bi-people fs-1 text-primary mb-3 d-block"></i>
            <h4>No Conversations Yet</h4>
            <p class="text-muted mb-4">Add friends to start chatting and sharing books!</p>
            <a href="{% url 'core:dashboard' %}" class="btn btn-primary btn-lg">
                <i class="bi bi-plus-circle me-2"></i>Find Friends
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}